<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<style>
/*
Simple div with a border
that is centered to its parent element.
Height and width are equal for now.
Later will allow this to scale down or up while
maintaining a sprite
*/

.CenterH1{
	margin: 10px auto;
	display:table;
	font-family:Luminari, cursive;
}

.Center{
	margin: 0px auto;
	width:200px;
	height:200px;
	display:table;
	border:2px solid purple;
}

.Row{
	width:100%;
	height:auto;
	display:table-row;
	border:3px solid green;
}

.Column{
	width:1%;
	text-align:center;
	display:table-cell;
	border:1px solid black;
}

</style>
<script type="text/javascript">

function CreateAsyncFunctions(Options){
	if(Options==null)
		return;
	if(Options.length<5){
		alert("Be wary of using this function recklessly...");
		return;
	}
	
	/*
	 * Options [[func1,Params,LogicFunction,MaxLife,Duration,AfterFunc],....,]
	 * LOGIC function takes all parameters...
	 * starting with MaxLife,Interval,Adder
	 * then add on any more parameters to logic func
	 * When lifecycle of async function is finished, 
	 	if AfterFunc exists, call this. 
	 	This is a callback from the async function,
	 	Can be chained indefinitely
	 */
	for(var i=0; i<Options.length;i+=1){
		
		var Func = Options[i][0];
		var Params = Options[i][1];
		var LogicFunction = Options[i][2];
		var MaxLife = Options[i][3];
		var Interval = 0;
		var Duration = Options[i][4];
		var AfterFunc  = undefined;
		if(Options[i].length>5)
			AfterFunc = Options[i][5];
		
		if(Duration<=0 || Params==null)
			return;
		
		(function(Params,LogicFunction,MaxLife,Interval,Duration){
			//Closure
			Time = function(){
				
			//console.log("FUNCTION IN ACTION");	
				
			Interval+=Duration * Math.random();
			
			var Ret;
			
			Ret = Func(Params);
			
			//console.log(Ret+">>"+Interval+">>"+MaxLife);
			
			var X = true;
			
			//Logic if exists
			if(LogicFunction)
				X = LogicFunction([MaxLife,Interval,Duration].concat(Params));
			
			//Logic Func not exist
			if(X==true){
				
				//console.log(Interval+">>"+MaxLife);
				
				//Commit STILL to the time
				if(Interval<=MaxLife)
				 setTimeout(Time, Duration*Math.random());
				else{
				
					if(AfterFunc!=null)
						AfterFunc();
					
					return;
				}
				 
				
			}
			else{
				
				if(AfterFunc!=null)
					AfterFunc();
				return;
				
				}
			
			}
			
			Time();
		
		})(Params,LogicFunction,MaxLife,Interval,Duration);
		
		
	}
	
}

//Set the type of empty space that you want
//Size may vary, but percentage taken will be consistent
//underscore was the best that I could find that is consistent
//So I will keep this here as the default
var EmptySpace = "_";

//Since a character takes up a const space in column, 
//This is not needed
//Zoom feature should increase the number of elements
//var ColumnWidth;

//code representation of the grid
//This can point DYNAMICALLY to each column element
//Or access each column element by its id
//Which is in format R,C -> Row,Column
var ASCIIGRID = [];

function AddRow(Grid){
	var Row = document.createElement("div");
	Row.className="Row";
	if(Grid){
		Grid.appendChild(Row);
		return Row;
	}
	else
		console.log("No Grid ELEMENT given");
}

//Add a column to a row
//Initial value is set 
function AddColumn(Row){
	var Column = document.createElement("span");
	Column.className="Column";
	Column.innerHTML=EmptySpace;
	
	if(Row){
		Row.appendChild(Column);
		return Column;	
	}
	else
		console.log("No Row ELEMENT Given!!");
}

//Create grid with height,width,precision
//Precision should be in the range of 1 -> inf
// Precision is just a multiplier to the 
//width and height
function CreateGrid(Height,Width,Precision){
	if(Height<=0 || Width<=0 || 
			(Precision<=0 && Precision)){
		console.log("INVALID CREATE GRID, see comments");
		return undefined;
	}
	else if(Precision){
		Height*=Precision;
		Width*=Precision;
	}
	
	var Center;
	var Centers = document.getElementsByClassName("Center");
	if(Centers.length>0){
		//Choosing first one that exists...
		Center = Centers[0];
	}
	else{
		Center = document.createElement("div");
		Center.className="Center";
	}
	
	//Do you want to increase the entire GRID
	//Or just decreate text
	Center.style.height = Height;
	Center.style.width = Width;
	
	document.body.appendChild(Center);
	
	//First Push a new Row element to Center div
	
	//Then push a new Column element to Row div
	//Set column element id to i,j
	//Push the column element to ASCIIGRID
	
	for(var i=0; i<Height;i++){
		
		var Row = AddRow(Center);
		if(!Row)
			{
				console.log("ERROR ADDING ROW (CreateGrid)["+i+","+j+"]");
				return null;
			}
		
		ASCIIGRID.push([]);
		
		for(var j=0; j<Width;++j){
			
			var Column = AddColumn(Row);
			if(!Column)
			{
				console.log("ERROR ADDING COLUMN (CreateGrid)["+i+","+j+"]");
				return null;
			}
			
			Column.id=i+","+j;
			
			var PrevFontSize = parseInt(Column.style.fontSize);
			Column.style.fontSize = ((PrevFontSize)/Precision)+"px";
			
			ASCIIGRID[i].push(Column);
			
		}	
	}
	
	
	return Center;
}

//Closure
//SubASCIIGrid is basically a grid element
//Which is a 2D array
//EX:
/*
 * 
 [
  ["S","P","A","C"],
  ["I","N","G",""] 	 
 ]
  // any string that is invalid will be replaces with the default
  // EmptySpace
 
 */
 
//But instead of storing elements, this stores ASCII values
//Can be as small as one element to as large as the grid
//PivitPosition is the position in which the topleft-most
//ASCII character of SubASCIIGrid will be placed INITIALLY on the
//ASCIIGRID, [R,C] format
//but.... if R and C is negative, that is OK!
//Upon animation, it will check if the point in the sprite CAN exist
//on grid, and if it can, then display it
// EX: if(document.getElementById(i+","+j)!=null) then populate
//and replace previous position with EmptySpace var

//Delay is time it will take to transition from point to point
//This is in milliseconds!
//A collection of transitions is what comprises the animation
function Sprite(PivotPosition,SubASCIIGrid,Delay) {
	if(!PivotPosition){
		console.log("SPRITE--No Pivot Position");
		return;
	}
	if(PivotPosition.length!=2){
		console.log("SPRITE--Invalid Pivot Position");
		return;
	}
	if(!SubASCIIGrid){
		console.log("SPRITE--No SUB ASCII GRID");
		return;
	}
	if(!Delay || Delay<0){
		console.log("Invalid Delay");
		return;
	}
	
	//Private Function for pretty print when initializing
	function PrettyPrintASCIIGrid(AG){
		for(var i=0; i<AG.length;i+=1){
			//for(var j=0; j<AG[i].length;j+=1){
				console.log(AG[i]);
			//}
			//console.log();
		}
	}
	
	//Create 2D list of all Previous positions by iterating
	//ASCIIGRID and keeping less than that and my sub grid together
	//And also set the previous positions to EmptySpace
	
	//Then Starting From Pivot Position, first translate this
	//Then translate all other positions based off of Difference
	//neighbors
	this.TranslateAll = function (Difference){
		
		console.log("TRANSLATE ALL BY DIFFERENCE:"+Difference);
		
		var Key;
		
		//Only need an offset if out of bounds in negative direction
		var Offset = [0,0];
		
		if(this.PivotPosition[0]<0){
			Offset[0] = (ASCIIGRID.length) +
			this.PivotPosition[0];
		}
		else if( this.PivotPosition[0]>=ASCIIGRID.length){
			Offset[0] = (ASCIIGRID.length-1) -
			this.PivotPosition[0];
		}
		if(this.PivotPosition[1]<0){
			Offset[1] = (ASCIIGRID[0].length) +
			this.PivotPosition[1];
		}
		else if(this.PivotPosition[1]>=ASCIIGRID[0].length){
			Offset[1] = (ASCIIGRID[0].length-1) -
			this.PivotPosition[1];
		}
		
		
		
		console.log("OFFSET:"+Offset);
		
		Key = this.PivotPosition[0]+","+this.PivotPosition[1];
		if(document.getElementById(Key)!=null)
			document.getElementById(Key).innerHTML=EmptySpace;
		
		var PreviousPivotPosition = this.PivotPosition;
		
		var ListOfNeighborPreviousPositions = [];
		
		var RC = 0;
		
		
		for(var i=PreviousPivotPosition[0]+Offset[0];  
								   RC<this.ASCIIGRID.length
								   &&i<ASCIIGRID.length+Offset[0];	
								   							i+=1){
			var CC = 0;
			for(var j=PreviousPivotPosition[1]+Offset[1]; 
									   CC<this.ASCIIGRID[RC].length
									   &&j<ASCIIGRID.length+Offset[1];
																j+=1){
					
					Key = (i-Offset[0])+","+(j-Offset[1]);
					var RelativeKey = [RC+","+CC];
					
					ListOfNeighborPreviousPositions
					.push([Key,RelativeKey]);
					
					if(document.getElementById(Key)!=null)
						document.getElementById(Key).innerHTML=EmptySpace;
					
					CC+=1;
					
			}
			RC+=1;
		}
		
		console.log(" PIVOT POSITION:"+this.PivotPosition);
		console.log(" VISIBLE Previous Positions -> Relative Positions:");
		PrettyPrintASCIIGrid(ListOfNeighborPreviousPositions);
		
		this.PivotPosition[0]+=Difference[0];
		this.PivotPosition[1]+=Difference[1];
		
		//Now translate the rest of the positions
		for(var i=0; i<ListOfNeighborPreviousPositions.length;i+=1){
			
			var Prev = ListOfNeighborPreviousPositions[i][0].split(",");
			
			var PrevRelative = 	ListOfNeighborPreviousPositions[i][1][0].split(",");
			
				if(document.getElementById(Prev[0]+","+Prev[1])!=null){
					var I = parseInt(Prev[0]);
					var J = parseInt(Prev[1]);
					
					I+=Difference[0];
					J+=Difference[1];
					
					var I2 = parseInt(PrevRelative[0]);
					var J2 = parseInt(PrevRelative[1]);
					
					var SpriteFragment = undefined;
					if(I>=0 && J>=0 ){
						if(I<ASCIIGRID.length)
							if(J<ASCIIGRID[I].length){
								SpriteFragment = this.ASCIIGRID[I2][J2];
							}
					}
					
					if(SpriteFragment!=undefined)
						document.getElementById(I+","+J).innerHTML
						= SpriteFragment;
					
				}
		}
		
	}
	
	//Private Static Function
	function ComputeDifference(P1,P2){
		return [P2[0]-P1[0],P2[1]-P1[1]];
	}
	
	// Private Static Vars are vars without this
	var PrivateVar1;
	
	//Otherwise they are public	
	//Pivot Position will be updates every transition
	this.PivotPosition = PivotPosition;
	this.ASCIIGRID = SubASCIIGrid;
	
	//Public function callable from object Sprite
	//Translation Function from here to there
	//ex if translate from [0,0] to [10,20],
	//You will need to ComputeDifference(P1,P2)
	//Then, with this info, loop through all sprite pixels
	//
	this.Translate = function(P2){
		if(!P2)
			{
			return;
			}
		if(P2.length!=2)
			return;
		
		var Difference = ComputeDifference(this.PivotPosition,P2);
		
		//Now use async func
		//which waits by the delay set
		//and then calls TranslateAll
		//starts at pivot
		
		this.TranslateAll(Difference);
	}
	
	console.log("Starting Position: "+this.PivotPosition);
	console.log("SUB ASCII GRID: ");
	PrettyPrintASCIIGrid(this.ASCIIGRID)
	    
	};
</script>
</head>
<body>
<h1 class="CenterH1">ASCII ART ANIMATION</h1>

<!-- Table row maximizes all children of row  -->
<!--
<div class="Row">
<div class="Column" style="font-size:12px;">_</div>
<div class="Column" style="font-size:3px;">t</div>
<div class="Column" style="font-size:3px;">t</div>
<div class="Column" style="font-size:3px;">t</div>
<div class="Column" style="font-size:3px;">t</div>
<div class="Column" style="font-size:3px;">t</div>

</div>
-->

<script type="text/javascript">

var Height = 20;
var Width = 40;

//Approximately, for every 1px in height, add 2 px in width
CreateGrid(Height,Width,1);

//Some testing
document.getElementById("5,5").innerHTML="a";

var Sprite1 = new Sprite(
		[19,0],
		[
		 ["*","*"],
		 ["*","*"]	
			],
		500
		);

Sprite1.Translate([5,5]);

</script>
</body>
</html>